---
title: Builder API
description: Complete reference for the SystemPromptBuilder API
---

# Builder API Reference

The `SystemPromptBuilder` class provides a fluent API for constructing type-safe system prompts for AI agents.

## Creating a Builder

### `createPromptBuilder()`

Factory function to create a new `SystemPromptBuilder` instance.

```typescript
import { createPromptBuilder } from "@promptsmith/core";

const builder = createPromptBuilder();
```

**Returns:** `SystemPromptBuilder`

---

## Configuration Methods

All configuration methods return `this` for method chaining.

### `identity(text: string)`

Sets the agent's core identity or purpose.

```typescript
builder.identity(
  "You are an expert travel assistant specializing in European destinations"
);
```

**Parameters:**

- `text` - Description of the agent's identity. Use second person ("You are...") or third person.

**Example:**

```typescript
builder.identity(
  "You are a senior software engineer with expertise in distributed systems"
);
```

---

### `capability(cap: string)`

Adds a single capability to the agent's skillset.

```typescript
builder.capability("Search and analyze research papers");
```

**Parameters:**

- `cap` - Single capability description

**Note:** Multiple calls accumulate capabilities.

**Example:**

```typescript
builder
  .capability("Explain complex concepts clearly")
  .capability("Provide code examples")
  .capability("Debug issues");
```

---

### `capabilities(caps: string[])`

Adds multiple capabilities at once.

```typescript
builder.capabilities([
  "Analyze financial data",
  "Calculate investment returns",
  "Generate reports",
]);
```

**Parameters:**

- `caps` - Array of capability descriptions

**Note:** Empty strings are filtered out automatically.

---

### `tool<T>(def: ExecutableToolDefinition<T>)`

Registers a tool that the agent can use.

```typescript
builder.tool({
  name: "get_weather",
  description: "Get current weather for a location",
  schema: z.object({
    location: z.string().describe("City name or ZIP code"),
    units: z.enum(["celsius", "fahrenheit"]).optional(),
  }),
  execute: async ({ location, units }) => {
    // Implementation
    return weatherData;
  },
});
```

**Type Parameters:**

- `T` - Zod schema type for the tool's parameters

**Parameters:**

- `def.name` - Unique tool identifier (snake_case recommended)
- `def.description` - Human-readable description of what the tool does
- `def.schema` - Zod schema defining input parameters
- `def.execute` (optional) - Async function that implements the tool

**Key Points:**

- Tool metadata is used to generate documentation in the system prompt
- The `execute` function is optional and used for runtime execution
- Zod schema is introspected to create parameter documentation
- Use `.describe()` on schema fields for detailed parameter descriptions

**Example with complex schema:**

```typescript
builder.tool({
  name: "search_database",
  description: "Search the product database",
  schema: z.object({
    query: z.string().describe("Search query text"),
    filters: z
      .object({
        category: z.string().optional(),
        minPrice: z.number().optional(),
        maxPrice: z.number().optional(),
      })
      .optional()
      .describe("Optional search filters"),
    limit: z
      .number()
      .min(1)
      .max(100)
      .default(10)
      .describe("Maximum results (1-100)"),
  }),
  execute: async ({ query, filters, limit }) => {
    // Fully typed parameters
    return searchResults;
  },
});
```

---

### `tools(defs: ExecutableToolDefinition[])`

Registers multiple tools at once.

```typescript
const myTools = [
  { name: "tool1", description: "First tool", schema: z.object({...}) },
  { name: "tool2", description: "Second tool", schema: z.object({...}) }
];

builder.tools(myTools);
```

**Parameters:**

- `defs` - Array of tool definitions

---

### `constraint(type: ConstraintType, rule: string)`

Adds a behavioral constraint or guideline.

```typescript
builder
  .constraint("must", "Always verify user authentication")
  .constraint("must_not", "Never store sensitive data")
  .constraint("should", "Provide concise responses")
  .constraint("should_not", "Avoid technical jargon");
```

**Parameters:**

- `type` - Constraint severity level:
  - `"must"` - Absolute requirements
  - `"must_not"` - Absolute prohibitions
  - `"should"` - Strong recommendations
  - `"should_not"` - Things to avoid when possible
- `rule` - Clear, specific constraint text (imperative mood)

**Organization:**
Constraints are automatically grouped by type in the generated prompt:

1. You MUST (most critical)
2. You MUST NOT
3. You SHOULD
4. You SHOULD NOT (least critical)

**Example:**

```typescript
builder
  .constraint("must", "Cite sources for all factual claims")
  .constraint("must", "Respect user privacy and data protection")
  .constraint("must_not", "Share confidential information")
  .constraint("must_not", "Make decisions involving money without confirmation")
  .constraint("should", "Ask clarifying questions when intent is unclear")
  .constraint("should_not", "Use abbreviated responses for complex topics");
```

---

### `output(format: string)`

Sets output format guidelines for responses.

```typescript
builder.output(`
  Format responses as:
  1. Summary (2-3 sentences)
  2. Details (use bullet points)
  3. Code examples (if relevant)
  4. Next steps
`);
```

**Parameters:**

- `format` - Output format description or template. Supports multi-line strings.

**Example:**

```typescript
builder.output(
  "Always respond in JSON format with 'answer' and 'confidence' fields"
);
```

---

### `withTone(tone: string)`

Sets the communication tone and style.

```typescript
builder.withTone("Be friendly, enthusiastic, and encouraging");
```

**Parameters:**

- `tone` - Description of desired communication style

**Examples:**

```typescript
// Professional
builder.withTone("Maintain a professional and formal tone. Be precise.");

// Educational
builder.withTone(
  "Be patient and educational. Explain concepts clearly without condescension."
);

// Conversational
builder.withTone("Use a warm, conversational tone. Be personable but helpful.");
```

---

## Output Methods

### `build()`

Builds and returns the complete system prompt as a markdown string.

```typescript
const systemPrompt = builder.build();
console.log(systemPrompt);
```

**Returns:** `string` - Markdown-formatted system prompt

**Generated Sections:**

1. Identity
2. Capabilities (numbered list)
3. Available Tools (with parameter documentation)
4. Behavioral Guidelines (organized by constraint type)
5. Communication Style
6. Output Format

Only sections with content are included.

---

### `getTools()`

Returns the list of registered tools.

```typescript
const tools = builder.getTools();
console.log(tools.length);
console.log(tools[0].name);
```

**Returns:** `ExecutableToolDefinition[]`

**Use Cases:**

- Introspection
- Validation
- Passing tools to other systems

---

### `toAiSdkTools()`

Exports tools in Vercel AI SDK format.

```typescript
const aiTools = builder.toAiSdkTools();

// Use with AI SDK
const response = await generateText({
  model: openai("gpt-4"),
  system: builder.build(),
  tools: aiTools,
  prompt: "User message",
});
```

**Returns:** `Record<string, AISDKTool>`

```typescript
type AISDKTool = {
  description: string;
  parameters: ZodType;
  execute?: (args: unknown) => Promise<unknown> | unknown;
};
```

**Behavior:**

- Converts Promptsmith tools to AI SDK format
- Tools without `execute` have it set to `undefined`
- Allows mixed tool sets (some executable, some documentation-only)

---

### `toAiSdk()`

Exports a complete AI SDK configuration object.

```typescript
const config = builder.toAiSdk();

// Use with spread operator
const response = await generateText({
  model: openai("gpt-4"),
  ...config,
  prompt: "What's the weather?",
  maxSteps: 5,
});
```

**Returns:**

```typescript
{
  system: string; // Complete system prompt
  tools: Record<string, AISDKTool>; // Tools in AI SDK format
}
```

This is the recommended way to use Promptsmith with Vercel AI SDK.

---

### `toJSON()`

Exports the builder's configuration as a plain object.

```typescript
const config = builder.toJSON();
console.log(config.identity);
console.log(config.capabilities);
```

**Returns:**

```typescript
{
  identity: string;
  capabilities: string[];
  tools: ExecutableToolDefinition[];
  constraints: Constraint[];
  outputFormat: string;
  tone: string;
}
```

**Use Cases:**

- Saving configurations
- Debugging
- Serialization (note: Zod schemas may not serialize perfectly)

---

## Method Chaining

All configuration methods return `this`, enabling fluent method chaining:

```typescript
const prompt = createPromptBuilder()
  .identity("You are a code reviewer")
  .capabilities([
    "Analyze code quality",
    "Suggest improvements",
    "Identify bugs",
  ])
  .tool({
    name: "analyze_code",
    description: "Analyze code for issues",
    schema: z.object({
      code: z.string(),
      language: z.string(),
    }),
  })
  .constraint("must", "Explain reasoning for all suggestions")
  .constraint("should", "Prioritize security issues")
  .withTone("Be constructive and helpful")
  .build();
```

---

## TypeScript Types

### `ToolDefinition<T>`

Base tool definition (documentation only):

```typescript
type ToolDefinition<T extends ZodType = ZodType> = {
  name: string;
  description: string;
  schema: T;
};
```

### `ExecutableToolDefinition<T>`

Tool definition with optional execution:

```typescript
interface ExecutableToolDefinition<T extends ZodType = ZodType>
  extends ToolDefinition<T> {
  execute?: (args: z.infer<T>) => Promise<unknown> | unknown;
}
```

### `ConstraintType`

Constraint severity levels:

```typescript
type ConstraintType = "must" | "must_not" | "should" | "should_not";
```

### `Constraint`

Constraint object:

```typescript
type Constraint = {
  type: ConstraintType;
  rule: string;
};
```

### `AiSdkConfig`

AI SDK configuration output:

```typescript
type AiSdkConfig = {
  system: string;
  tools: Record<
    string,
    {
      description: string;
      parameters: ZodType;
      execute?: (args: unknown) => Promise<unknown> | unknown;
    }
  >;
};
```

---

## Best Practices

### 1. Clear Identity

```typescript
// ✅ Good - Specific and clear
builder.identity("You are a senior DevOps engineer specializing in Kubernetes");

// ❌ Bad - Too vague
builder.identity("You are helpful");
```

### 2. Actionable Capabilities

```typescript
// ✅ Good - Action-oriented
builder.capability("Deploy applications to production environments");

// ❌ Bad - Too generic
builder.capability("Do DevOps stuff");
```

### 3. Detailed Tool Descriptions

```typescript
// ✅ Good - Clear when to use
builder.tool({
  name: "search_docs",
  description: "Search technical documentation. Use when user asks about APIs, libraries, or specific functions.",
  schema: z.object({...})
});

// ❌ Bad - Unclear usage
builder.tool({
  name: "search_docs",
  description: "Searches stuff",
  schema: z.object({...})
});
```

### 4. Use Schema Descriptions

```typescript
// ✅ Good - Descriptive parameters
schema: z.object({
  location: z.string().describe("City name, ZIP code, or coordinates"),
  radius: z.number().describe("Search radius in kilometers"),
  units: z.enum(["metric", "imperial"]).describe("Measurement system"),
});

// ❌ Bad - No descriptions
schema: z.object({
  location: z.string(),
  radius: z.number(),
  units: z.enum(["metric", "imperial"]),
});
```

### 5. Constraint Priority

Use `must`/`must_not` sparingly for critical requirements:

```typescript
builder
  .constraint("must", "Always verify user authentication") // Security - critical
  .constraint("should", "Provide examples when explaining"); // Quality - nice to have
```

---

## Complete Example

```typescript
import { createPromptBuilder } from "@promptsmith/core";
import { z } from "zod";

const documentationAssistant = createPromptBuilder()
  // Identity
  .identity("You are an expert technical documentation assistant")

  // Capabilities
  .capabilities([
    "Search and retrieve documentation",
    "Explain complex technical concepts",
    "Provide code examples",
    "Answer API-related questions",
  ])

  // Tools
  .tool({
    name: "search_docs",
    description: "Search technical documentation by query",
    schema: z.object({
      query: z.string().describe("Search query"),
      section: z.enum(["api", "guides", "tutorials"]).optional(),
    }),
    execute: async ({ query, section }) => {
      return await searchDocs(query, section);
    },
  })
  .tool({
    name: "get_code_example",
    description: "Retrieve a code example by ID",
    schema: z.object({
      exampleId: z.string().describe("Example identifier"),
    }),
    execute: async ({ exampleId }) => {
      return await fetchExample(exampleId);
    },
  })

  // Constraints
  .constraint("must", "Always cite the source documentation for your answers")
  .constraint("must", "Verify code examples are current and working")
  .constraint("must_not", "Never invent API endpoints or methods")
  .constraint("should", "Provide links to relevant documentation pages")
  .constraint("should", "Include code examples when explaining concepts")

  // Style
  .withTone(
    "Be clear and professional. Assume the user has intermediate technical knowledge."
  )

  // Format
  .output(
    `
    Structure responses as:
    1. Direct answer to the question
    2. Code example (if applicable)  
    3. Additional context or related information
    4. Links to full documentation
  `
  )

  // Build
  .build();

export { documentationAssistant };
```
